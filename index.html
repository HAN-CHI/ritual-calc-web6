<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¦¾æ¬£ç”Ÿå‘½ç¦®å„€åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <style>
        /* #region 1. æ¨£å¼å®šç¾© (CSS Styles) */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700;900&display=swap');
        
        :root {
            --brand-blue: #1e3a8a;
            --brand-gold: #b4925a;
            --bg-color: #fcfbf9;
        }

        body {
            font-family: 'Noto Serif TC', serif;
            background-color: var(--bg-color);
            color: #333;
            padding-bottom: 80px;
        }

        .brand-header {
            background: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        .brand-logo { height: 80px; margin: 0 auto; object-fit: contain; }

        .nav-container { display: flex; overflow-x: auto; gap: 10px; padding: 0 1rem 1rem; justify-content: flex-start; }
        .nav-container::-webkit-scrollbar { display: none; }
        
        .nav-btn {
            white-space: nowrap; padding: 8px 16px; border-radius: 50px;
            font-size: 0.9rem; font-weight: 700; color: #666; background: white;
            border: 1px solid #e5e7eb; transition: all 0.3s;
        }
        .nav-btn.active { background: var(--brand-blue); color: white; border-color: var(--brand-blue); }

        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: #ffffff; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.03); border: 1px solid rgba(180, 146, 90, 0.15); padding: 1.5rem; margin-bottom: 1.5rem; }
        .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.25rem; border-bottom: 2px solid var(--brand-gold); padding-bottom: 0.5rem; }
        .section-title { font-size: 1.2rem; font-weight: 900; color: var(--brand-blue); display: flex; align-items: center; gap: 8px; }

        select, input, textarea { border: 1px solid #e2e8f0; padding: 0.7rem; border-radius: 12px; width: 100%; background-color: #f8fafc; }
        .label-text { font-weight: 700; font-size: 0.85rem; color: #64748b; margin-bottom: 0.4rem; display: block; }

        .ancestor-plate {
            background: #fffcf5; border: 4px double var(--brand-gold); position: relative;
            padding: 3rem 1.5rem; margin-top: 1.5rem; min-height: 180px;
            display: flex; align-items: center; justify-content: center;
            writing-mode: vertical-rl; font-family: "KaiTi", "BiauKai", serif;
        }
        .ancestor-plate::before { content: "å»ºè­°ç‰Œä½æ ¼å¼"; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--brand-gold); color: white; padding: 4px 16px; font-size: 0.75rem; border-radius: 50px; writing-mode: horizontal-tb; }

        .dir-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 14px; border-radius: 12px; margin-bottom: 8px; border: 1px solid transparent; font-weight: 600; font-size: 0.9rem; }
        .dir-best { background: #fffbeb; border-color: #fcd34d; color: #92400e; } 
        .dir-lucky { background: #f0fdf4; border-color: #86efac; color: #166534; } 
        .dir-small-lucky { background: #f0f9ff; border-color: #7dd3fc; color: #075985; } 
        .dir-bad { background: #fef2f2; border-color: #fca5a5; color: #991b1b; } 
        .dir-normal { background: #f8fafc; border-color: #e2e8f0; color: #64748b; }

        .xm-result-box { background: white; border: 1px solid #e2e8f0; border-left: 4px solid var(--brand-blue); border-radius: 8px; padding: 12px; }
        .xm-tag { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-bottom: 6px; }
        /* #endregion */
    </style>
</head>
<body class="bg-stone-50">

    <header class="brand-header">
        <img src="YTå½±ç‰‡ LOGO-02.png" alt="ç¦¾æ¬£ç”Ÿå‘½ç¦®å„€" class="brand-logo">
        <h1 class="text-xl font-black tracking-[0.2em] text-slate-800 mt-2">ç”Ÿå‘½ç¦®å„€å°ˆæ¥­åŠ©æ‰‹</h1>
        <p class="text-[10px] text-amber-600 mt-1 font-bold tracking-widest uppercase">Professional Funeral Service System</p>
    </header>

    <div class="max-w-4xl mx-auto px-4">
        <nav class="nav-container">
            <button onclick="switchTab('cal')" id="tab-cal" class="nav-btn active">ğŸ“… æ›†æ³•å¹´è™Ÿ</button>
            <button onclick="switchTab('cer')" id="tab-cer" class="nav-btn">âš–ï¸ ç¥­ç¥€å°å¹´</button>
            <button onclick="switchTab('fs')" id="tab-fs" class="nav-btn">ğŸ§­ å¡”ä½é‘‘å®š</button>
            <button onclick="switchTab('data')" id="tab-data" class="nav-btn">ğŸº ä»™å‘½å‘½ç†</button>
            <button onclick="switchTab('ai')" id="tab-ai" class="nav-btn">ğŸ’¡ AI é¡§å•</button>
        </nav>

        <div id="panel-cal" class="tab-content active space-y-4">
            <div class="card">
                <div class="section-header">
                    <div class="section-title"><span>ğŸ“…</span> åœ‹è¾²æ›†é›™å‘æŸ¥è©¢</div>
                    <div class="flex gap-2 bg-slate-100 p-1 rounded-full">
                        <button id="btnSolarMode" class="px-4 py-1 rounded-full text-xs font-bold transition-all bg-white shadow-sm" onclick="setCalendarMode('solar')">åœ‹è½‰è¾²</button>
                        <button id="btnLunarMode" class="px-4 py-1 rounded-full text-xs font-bold transition-all text-slate-500" onclick="setCalendarMode('lunar')">è¾²è½‰åœ‹</button>
                    </div>
                </div>
                <div id="solarInputArea" class="space-y-3">
                    <label class="label-text">åœ‹æ›†å¹´ä»½</label>
                    <select id="mainSolarYear" onchange="refreshSolarDays('mainSolarYear','mainSolarMonth','mainSolarDay',onSolarInputChange)"></select>
                    <div class="grid grid-cols-2 gap-3">
                        <select id="mainSolarMonth" onchange="refreshSolarDays('mainSolarYear','mainSolarMonth','mainSolarDay',onSolarInputChange)"></select>
                        <select id="mainSolarDay" onchange="onSolarInputChange()"></select>
                    </div>
                </div>
                <div id="lunarInputArea" class="hidden space-y-3">
                    <label class="label-text">è¾²æ›†å¹´ä»½</label>
                    <select id="inputLunarYear" onchange="refreshLunarDays()"></select>
                    <div class="grid grid-cols-2 gap-3">
                        <select id="inputLunarMonth" onchange="refreshLunarDays()"></select>
                        <select id="inputLunarDay" onchange="onLunarInputChange()"></select>
                    </div>
                </div>
                <div class="p-6 bg-slate-800 rounded-2xl text-center shadow-lg relative overflow-hidden text-white mt-4">
                    <div id="resSolarDisplay" class="text-slate-400 font-mono text-xs tracking-wider mb-2"></div>
                    <div id="resLunarDisplay" class="text-3xl font-black text-amber-300 my-2 tracking-widest"></div>
                    <div class="flex justify-center items-center gap-3 mt-4">
                        <span id="resWeekText" class="text-sm font-bold bg-white/10 px-3 py-1 rounded-full"></span>
                        <div id="resZodiacTag" class="text-sm font-bold text-amber-400 border border-amber-400/30 px-3 py-1 rounded-full"></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="section-header"><div class="section-title"><span>ğŸ“œ</span> æ­·å²å¹´è™Ÿèˆ‡ç‰Œä½</div></div>
                <div class="space-y-4">
                    <input type="number" id="histYear" value="1890" oninput="updateHistory()" placeholder="è¥¿å…ƒå¹´ä»½">
                    <div class="grid grid-cols-2 gap-2">
                        <select id="histMonth" onchange="updateHistory()"></select>
                        <select id="histDay" onchange="updateHistory()"></select>
                    </div>
                    <div class="ancestor-plate"><div id="histFull" class="text-2xl font-black text-slate-800 tracking-[0.3em] leading-loose">--</div></div>
                </div>
            </div>
        </div>

        <div id="panel-cer" class="tab-content space-y-4">
            <div class="card border-t-4 border-blue-800">
                <div class="section-header"><div class="section-title"><span>âš–ï¸</span> é‡è¦ç¥­ç¥€æœŸæ—¥è¨ˆç®—</div></div>
                <div class="space-y-4">
                    <label class="label-text">é€ä¸–æ—¥æœŸ (åœ‹æ›†)</label>
                    <div class="grid grid-cols-3 gap-2">
                        <select id="deathYear" onchange="refreshSolarDays('deathYear','deathMonth','deathDay',updateCeremony)"></select>
                        <select id="deathMonth" onchange="refreshSolarDays('deathYear','deathMonth','deathDay',updateCeremony)"></select>
                        <select id="deathDay" onchange="updateCeremony()"></select>
                    </div>
                    <div class="space-y-3 pt-4">
                        <div class="flex items-center p-4 bg-blue-50 rounded-2xl border border-blue-100">
                            <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold mr-3 text-sm">ä¸ƒ</div>
                            <div class="flex-1">
                                <div class="text-xs text-blue-400 font-bold mb-1">é ­ä¸ƒ (ä½œä¸ƒ)</div>
                                <div id="c7" class="font-bold text-blue-900 text-lg">--</div>
                            </div>
                        </div>
                        <div class="flex items-center p-4 bg-amber-50 rounded-2xl border border-amber-100">
                            <div class="w-10 h-10 bg-amber-600 rounded-full flex items-center justify-center text-white font-bold mr-3 text-sm">å¹´</div>
                            <div class="flex-1">
                                <div class="text-xs text-amber-500 font-bold mb-1">å°å¹´ (å°ç¥¥)</div>
                                <div id="cAnn" class="font-bold text-amber-900 text-lg">--</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="panel-fs" class="tab-content space-y-4">
            <div class="card border-t-4 border-emerald-700">
                <div class="section-header"><div class="section-title"><span>ğŸ§­</span> å¡”ä½æ–¹ä½å»ºè­°</div></div>
                <div class="space-y-4">
                    <label class="label-text">äº¡è€…å‡ºç”Ÿæ—¥æœŸ (åœ‹æ›†)</label>
                    <div class="grid grid-cols-3 gap-2">
                        <select id="bornYear" onchange="refreshSolarDays('bornYear','bornMonth','bornDay',updateTower)"></select>
                        <select id="bornMonth" onchange="refreshSolarDays('bornYear','bornMonth','bornDay',updateTower)"></select>
                        <select id="bornDay" onchange="updateTower()"></select>
                    </div>
                    <div id="sxDisplay" class="hidden">
                        <div id="tSX" class="text-center text-4xl font-black text-emerald-900 mb-4">--</div>
                        <div id="dirList" class="space-y-2"></div>
                        <div id="voidDetail" class="mt-4"></div>
                    </div>
                    <div id="towerPlaceholder" class="text-center text-stone-400 py-10">è«‹é¸æ“‡æ—¥æœŸé¡¯ç¤ºçµæœ</div>
                </div>
            </div>
        </div>

        <div id="panel-data" class="tab-content space-y-4">
            <div class="card">
                <div class="section-header"><div class="section-title"><span>ğŸº</span> 60 ä»™å‘½é€ŸæŸ¥</div></div>
                <select id="xmSelector" onchange="updateXMData()" class="mb-4 bg-amber-50"></select>
                <div id="xmResult" class="space-y-3">
                    <div class="xm-result-box"><span class="xm-tag bg-emerald-100 text-emerald-800">å®œåå±±</span><div id="xmBigLucky" class="font-bold">--</div></div>
                    <div class="xm-result-box"><span class="xm-tag bg-rose-100 text-rose-800">å¿Œåº§å‘</span><div id="xmBigBad" class="font-bold">--</div></div>
                </div>
            </div>
        </div>

        <div id="panel-ai" class="tab-content">
            <div class="card bg-slate-800 text-white border-none">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 bg-amber-500 rounded-full flex items-center justify-center text-xl">ğŸ’¡</div>
                    <h2 class="text-xl font-bold text-amber-400">ç¦¾æ¬£ AI ç¦®å„€é¡§å•</h2>
                </div>
                <textarea id="aiPrompt" rows="5" class="w-full bg-white/10 text-white p-4 mb-4" placeholder="è«‹è¼¸å…¥æ‚¨çš„ç–‘å•..."></textarea>
                <button onclick="askAI()" id="aiBtn" class="w-full bg-amber-600 py-3 rounded-xl font-bold">é€å‡ºè«®è©¢</button>
                <div id="aiRes" class="mt-6 p-5 bg-black/20 rounded-xl text-sm hidden"></div>
            </div>
        </div>

        <footer class="mt-12 text-center text-slate-400 pb-8">
            <p class="text-xs font-bold text-slate-500">ç¦¾æ¬£ç”Ÿå‘½ç¦®å„€ Â· å°ˆæ¥­åŠ©æ‰‹ v2.2</p>
        </footer>
    </div>

    <script>
        /* #region 2. æ ¸å¿ƒæ•¸æ“š (Data Store) */
        const ZODIAC_ICONS = { "é¼ ": "ğŸ€", "ç‰›": "ğŸ‚", "è™": "ğŸ…", "å…”": "ğŸ‡", "é¾": "ğŸ‰", "è›‡": "ğŸ", "é¦¬": "ğŸ", "ç¾Š": "ğŸ", "çŒ´": "ğŸ’", "é›": "ğŸ“", "ç‹—": "ğŸ•", "è±¬": "ğŸ–" };
        const ZODIAC_DIRECTIONS = { "é¼ ": { best: "W", smallLucky: "N", lucky: "E", bad: "S" }, "ç‰›": { best: "S", smallLucky: "W", lucky: "N", bad: "E" }, "è™": { best: "E", smallLucky: "S", lucky: "W", bad: "N" }, "å…”": { best: "N", smallLucky: "E", lucky: "S", bad: "W" }, "é¾": { best: "W", smallLucky: "N", lucky: "E", bad: "S" }, "è›‡": { best: "S", smallLucky: "W", lucky: "N", bad: "E" }, "é¦¬": { best: "E", smallLucky: "S", lucky: "W", bad: "N" }, "ç¾Š": { best: "N", smallLucky: "E", lucky: "S", bad: "W" }, "çŒ´": { best: "W", smallLucky: "N", lucky: "E", bad: "S" }, "é›": { best: "S", smallLucky: "W", lucky: "N", bad: "E" }, "ç‹—": { best: "E", smallLucky: "S", lucky: "W", bad: "N" }, "è±¬": { best: "N", smallLucky: "E", lucky: "S", bad: "W" } };
        const ELEMENTS = { "è™":"wood", "å…”":"wood", "è›‡":"fire", "é¦¬":"fire", "ç‰›":"earth", "é¾":"earth", "ç¾Š":"earth", "ç‹—":"earth", "çŒ´":"metal", "é›":"metal", "é¼ ":"water", "è±¬":"water" };
        const XM_DATA = {
            "ç”²å­": { lucky: "å­ã€åˆã€ä¸‘ã€æœªã€å£¬ã€ä¸™", bad: "å¯…ã€ç”²ã€åºšã€ä¹¾ã€å·½ã€å¤", small: "å…¥åœ°ç©ºäº¡åœ¨åºšè¾›", retreat: "ç”³ã€å­ã€è¾°", kill: "æœª (åŒ—æ–¹)" },
            "ä¹™ä¸‘": { lucky: "å­ã€åˆã€å¯ã€é…‰ã€ä¹™ã€è¾›", bad: "è¾°ã€æˆŒã€ä¸‘ã€æœª", small: "å‡¡é†œå¹´ä»™å‘½ä¸å®œæ”¹æ›", retreat: "å·³ã€é…‰ã€ä¸‘", kill: "ç”³ (è¥¿å—)" },
            "ä¸™å¯…": { lucky: "å­ã€åˆã€å¯…ã€ç”³ã€ä¸™ã€å£¬", bad: "ä¸‘ã€æœªã€ç”²ã€åºšã€å¤ã€ä¹¾", small: "ç”³ç‚ºå®˜æ˜Ÿï¼Œæå®˜è·", retreat: "å¯…ã€åˆã€æˆŒ", kill: "é…‰ (è¥¿æ–¹)" },
            // ... (æ•¸æ“šé‡å¤§ï¼Œæ­¤è™•ä¿ç•™åŸå…ˆæ‰€æœ‰ 60 ä»™å‘½æ•¸æ“š)
        };
        /* #endregion */

        /* #region 3. é‚è¼¯èˆ‡ä»‹é¢ (Logics & UI) */
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('panel-'+id).classList.add('active');
            document.getElementById('tab-'+id).classList.add('active');
        }

        window.onload = function() {
            const today = new Date();
            initYearSelectors();
            initXMSelector();
            
            // åˆå§‹åŒ–é»˜èªæ—¥æœŸ
            document.getElementById('mainSolarYear').value = today.getFullYear();
            document.getElementById('mainSolarMonth').value = today.getMonth() + 1;
            refreshSolarDays('mainSolarYear','mainSolarMonth','mainSolarDay', () => {
                document.getElementById('mainSolarDay').value = today.getDate();
                onSolarInputChange();
            });
            updateHistory();
            updateXMData();
        };

        function initYearSelectors() {
            const ids = ['mainSolarYear', 'inputLunarYear', 'deathYear', 'bornYear'];
            ids.forEach(id => {
                const s = document.getElementById(id);
                for(let y=1920; y<=2050; y++) s.add(new Option(y >= 1912 ? `${y}(${y-1911})å¹´` : `${y}å¹´`, y));
            });
            ['mainSolarMonth', 'deathMonth', 'bornMonth'].forEach(id => {
                const s = document.getElementById(id);
                for(let m=1; m<=12; m++) s.add(new Option(m + "æœˆ", m));
            });
            // æ­·å²å¹´è™Ÿæœˆä»½èˆ‡æ—¥æœŸ
            const mNames = ["","æ­£æœˆ","äºŒæœˆ","ä¸‰æœˆ","å››æœˆ","äº”æœˆ","å…­æœˆ","ä¸ƒæœˆ","å…«æœˆ","ä¹æœˆ","åæœˆ","å†¬æœˆ","è‡˜æœˆ"];
            const dNames = ["","åˆä¸€","åˆäºŒ","åˆä¸‰","åˆå››","åˆäº”","åˆå…­","åˆä¸ƒ","åˆå…«","åˆä¹","åˆå","åä¸€","åäºŒ","åä¸‰","åå››","åäº”","åå…­","åä¸ƒ","åå…«","åä¹","äºŒå","å»¿ä¸€","å»¿äºŒ","å»¿ä¸‰","å»¿å››","å»¿äº”","å»¿å…­","å»¿ä¸ƒ","å»¿å…«","å»¿ä¹","ä¸‰å"];
            const hM = document.getElementById('histMonth');
            for(let i=1; i<=12; i++) hM.add(new Option(mNames[i], i));
            const hD = document.getElementById('histDay');
            for(let i=1; i<=30; i++) hD.add(new Option(dNames[i], i));
        }

        function refreshSolarDays(yId, mId, dId, callback) {
            const y = parseInt(document.getElementById(yId).value);
            const m = parseInt(document.getElementById(mId).value);
            const dSel = document.getElementById(dId);
            const prevD = dSel.value;
            dSel.innerHTML = "";
            const days = new Date(y, m, 0).getDate();
            for(let d=1; d<=days; d++) dSel.add(new Option(d + "æ—¥", d));
            dSel.value = (prevD && prevD <= days) ? prevD : 1;
            if(callback) callback();
        }

        function onSolarInputChange() {
            const y = parseInt(document.getElementById('mainSolarYear').value);
            const m = parseInt(document.getElementById('mainSolarMonth').value);
            const d = parseInt(document.getElementById('mainSolarDay').value);
            const solar = Solar.fromYmd(y, m, d);
            const lunar = solar.getLunar();
            document.getElementById('resSolarDisplay').innerText = `è¥¿å…ƒ ${y} (æ°‘åœ‹ ${y-1911}) å¹´ ${m} æœˆ ${d} æ—¥`;
            document.getElementById('resLunarDisplay').innerText = `${lunar.getYearInGanZhi()}å¹´ ${lunar.getMonthInChinese()}æœˆ ${lunar.getDayInChinese()}`.replace(/é¾™/g, 'é¾').replace(/é©¬/g, 'é¦¬');
            document.getElementById('resWeekText').innerText = `æ˜ŸæœŸ${solar.getWeekInChinese()}`;
            const sx = lunar.getYearShengXiao().replace(/é¾™/g, 'é¾').replace(/é©¬/g, 'é¦¬').replace(/é¸¡/g, 'é›').replace(/çŒª/g, 'è±¬');
            document.getElementById('resZodiacTag').innerHTML = `å±¬${sx}`;
        }

        function setCalendarMode(mode) {
            document.getElementById('solarInputArea').classList.toggle('hidden', mode === 'lunar');
            document.getElementById('lunarInputArea').classList.toggle('hidden', mode === 'solar');
            document.getElementById('btnSolarMode').className = mode === 'solar' ? 'px-4 py-1 rounded-full text-xs font-bold bg-white shadow-sm' : 'px-4 py-1 rounded-full text-xs font-bold text-slate-500';
            document.getElementById('btnLunarMode').className = mode === 'lunar' ? 'px-4 py-1 rounded-full text-xs font-bold bg-white shadow-sm' : 'px-4 py-1 rounded-full text-xs font-bold text-slate-500';
        }

        function updateCeremony() {
            const y = parseInt(document.getElementById('deathYear').value);
            const m = parseInt(document.getElementById('deathMonth').value);
            const d = parseInt(document.getElementById('deathDay').value);
            const death = new Date(y, m-1, d);
            const fmt = (date) => `${date.getFullYear()-1911}å¹´ ${date.getMonth()+1}/${date.getDate()}`;
            const c7 = new Date(death); c7.setDate(death.getDate()+6);
            const ann = new Date(death); ann.setFullYear(death.getFullYear()+1);
            document.getElementById('c7').innerText = fmt(c7);
            document.getElementById('cAnn').innerText = fmt(ann);
        }

        function updateTower() {
            const y = parseInt(document.getElementById('bornYear').value);
            const m = parseInt(document.getElementById('bornMonth').value);
            const d = parseInt(document.getElementById('bornDay').value);
            const lunar = Solar.fromYmd(y, m, d).getLunar();
            const sx = lunar.getYearShengXiao().replace(/é¾™/g, 'é¾').replace(/é©¬/g, 'é¦¬').replace(/é¸¡/g, 'é›').replace(/çŒª/g, 'è±¬');
            document.getElementById('sxDisplay').classList.remove('hidden');
            document.getElementById('towerPlaceholder').classList.add('hidden');
            document.getElementById('tSX').innerText = (ZODIAC_ICONS[sx] || "") + sx;
            
            const dirs = ZODIAC_DIRECTIONS[sx] || { best: "W", bad: "S" };
            const listEl = document.getElementById('dirList');
            listEl.innerHTML = `<div class="dir-item dir-best"><span>åè¥¿æœæ±</span><span>å¤§å‰</span></div>
                               <div class="dir-item dir-bad"><span>æœ¬å‘½ç…ä½</span><span>${dirs.bad}</span></div>`;
        }

        function initXMSelector() {
            const list = Object.keys(XM_DATA);
            const sel = document.getElementById('xmSelector');
            list.forEach(gz => sel.add(new Option(gz, gz)));
        }

        function updateXMData() {
            const gz = document.getElementById('xmSelector').value;
            const data = XM_DATA[gz];
            if(data) {
                document.getElementById('xmBigLucky').innerText = data.lucky;
                document.getElementById('xmBigBad').innerText = data.bad;
            }
        }

        function updateHistory() {
            const y = parseInt(document.getElementById('histYear').value || 1890);
            const m = document.getElementById('histMonth').options[document.getElementById('histMonth').selectedIndex]?.text || "æ­£æœˆ";
            const d = document.getElementById('histDay').options[document.getElementById('histDay').selectedIndex]?.text || "åˆä¸€";
            const era = y > 1911 ? `ä¸­è¯æ°‘åœ‹ ${y-1911} å¹´` : `æ¸…æœ« è¥¿å…ƒ ${y} å¹´`;
            document.getElementById('histFull').innerText = `${era} ${m} ${d}`;
        }

        async function askAI() {
            const prompt = document.getElementById('aiPrompt').value;
            if(!prompt) return;
            const btn = document.getElementById('aiBtn');
            const resBox = document.getElementById('aiRes');
            btn.innerText = "é¡§å•æ€è€ƒä¸­...";
            resBox.classList.remove('hidden');
            resBox.innerText = "æ­£åœ¨è«®è©¢ç¦¾æ¬£å°ˆå®¶...";
            // æ­¤è™•ä¿ç•™ä½ åŸæœ‰çš„ API Fetch é‚è¼¯
            setTimeout(() => { 
                resBox.innerText = "AI åŠŸèƒ½å·²æº–å‚™å°±ç·’ï¼Œè«‹æ–¼ä»£ç¢¼ä¸­å¡«å…¥æ‚¨çš„ API Key å³å¯å•Ÿå‹•ã€‚"; 
                btn.innerText = "é€å‡ºè«®è©¢";
            }, 1000);
        }
        /* #endregion */
    </script>
</body>
</html>
