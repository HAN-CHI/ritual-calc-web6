<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>禾欣生命禮儀助手 v2.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-stone-50">

    <header class="brand-header">
        <img src="YT影片 LOGO-02.png" alt="禾欣生命禮儀" class="brand-logo">
        <h1 class="text-xl font-black tracking-[0.2em] text-slate-800 mt-2">生命禮儀專業助手</h1>
        <p class="text-[10px] text-amber-600 mt-1 font-bold tracking-widest uppercase">Professional Funeral Service System</p>
    </header>

    <div class="max-w-4xl mx-auto px-4">
        <nav class="nav-container">
            <button onclick="switchTab('cal')" id="tab-cal" class="nav-btn active">📅 曆法年號</button>
            <button onclick="switchTab('cer')" id="tab-cer" class="nav-btn">⚖️ 祭祀對年</button>
            <button onclick="switchTab('fs')" id="tab-fs" class="nav-btn">🧭 塔位鑑定</button>
            <button onclick="switchTab('data')" id="tab-data" class="nav-btn">🏺 仙命命理</button>
            <button onclick="switchTab('ai')" id="tab-ai" class="nav-btn">💡 AI 顧問</button>
        </nav>

        <div id="panel-cal" class="tab-content active space-y-4">
            <div class="card">
                <div class="section-header">
                    <div class="section-title"><span>📅</span> 國農曆雙向查詢</div>
                    <div class="mode-toggle">
                        <button id="btnSolarMode" class="mode-btn active" onclick="setCalendarMode('solar')">國轉農</button>
                        <button id="btnLunarMode" class="mode-btn" onclick="setCalendarMode('lunar')">農轉國</button>
                    </div>
                </div>
                <div class="space-y-4">
                    <div id="solarInputArea" class="space-y-3">
                        <div><label class="label-text">國曆年份</label><select id="mainSolarYear" onchange="refreshSolarDays('mainSolarYear','mainSolarMonth','mainSolarDay',onSolarInputChange)"></select></div>
                        <div class="grid grid-cols-2 gap-3">
                            <div><label class="label-text">國曆月份</label><select id="mainSolarMonth" onchange="refreshSolarDays('mainSolarYear','mainSolarMonth','mainSolarDay',onSolarInputChange)"></select></div>
                            <div><label class="label-text">國曆日期</label><select id="mainSolarDay" onchange="onSolarInputChange()"></select></div>
                        </div>
                    </div>
                    <div id="lunarInputArea" class="hidden space-y-3">
                        <div><label class="label-text">農曆年份</label><select id="inputLunarYear" onchange="refreshLunarDays()"></select></div>
                        <div class="grid grid-cols-2 gap-3">
                            <div><label class="label-text">農曆月份</label><select id="inputLunarMonth" onchange="refreshLunarDays()"></select></div>
                            <div><label class="label-text">農曆日期</label><select id="inputLunarDay" onchange="onLunarInputChange()"></select></div>
                        </div>
                    </div>
                    <div class="result-display-box mt-4">
                        <div id="resSolarDisplay" class="text-slate-400 font-mono text-xs tracking-wider mb-2"></div>
                        <div id="resLunarDisplay" class="text-3xl font-black text-amber-300 my-2 tracking-widest"></div>
                        <div class="flex justify-center items-center gap-3 mt-4">
                            <span id="resWeekText" class="text-sm font-bold bg-white/10 px-3 py-1 rounded-full"></span>
                            <div id="resZodiacTag" class="text-sm font-bold text-amber-400 border border-amber-400/30 px-3 py-1 rounded-full"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="section-header"><div class="section-title"><span>📜</span> 歷史年號與牌位</div></div>
                <div class="space-y-4">
                    <div><label class="label-text">查詢年份 (西元)</label><input type="number" id="histYear" value="1890" oninput="updateHistory()"></div>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="label-text">農曆月</label><select id="histMonth" onchange="updateHistory()"></select></div>
                        <div><label class="label-text">農曆日</label><select id="histDay" onchange="updateHistory()"></select></div>
                    </div>
                    <div class="ancestor-plate"><div id="histFull" class="text-2xl font-black text-slate-800 tracking-[0.3em] leading-loose">--</div></div>
                </div>
            </div>
        </div>

        <div id="panel-cer" class="tab-content space-y-4">
            <div class="card border-t-4 border-blue-800">
                <div class="section-header"><div class="section-title"><span>⚖️</span> 重要祭祀期日計算</div></div>
                <div class="space-y-3">
                    <label class="label-text">逝世日期 (國曆)</label>
                    <div class="grid grid-cols-3 gap-2">
                        <select id="deathYear" onchange="refreshSolarDays('deathYear','deathMonth','deathDay',updateCeremony)"></select>
                        <select id="deathMonth" onchange="refreshSolarDays('deathYear','deathMonth','deathDay',updateCeremony)"></select>
                        <select id="deathDay" onchange="updateCeremony()"></select>
                    </div>
                    <div class="ceremony-results mt-6 space-y-3">
                        <div class="ceremony-item bg-blue-50" id="item-c7">
                            <span class="label">頭七 (作七)</span>
                            <span id="c7" class="value text-blue-900">--</span>
                        </div>
                        <div class="ceremony-item bg-slate-50" id="item-c100">
                            <span class="label">百日 (卒哭)</span>
                            <span id="c100" class="value text-slate-900">--</span>
                        </div>
                        <div class="ceremony-item bg-amber-50" id="item-cann">
                            <span class="label">對年 (小祥)</span>
                            <span id="cAnn" class="value text-amber-900">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="panel-fs" class="tab-content space-y-4">
            <div class="card border-t-4 border-emerald-700">
                <div class="section-header"><div class="section-title"><span>🧭</span> 塔位方位建議</div></div>
                <div class="grid grid-cols-3 gap-2 mb-4">
                    <select id="bornYear" onchange="refreshSolarDays('bornYear','bornMonth','bornDay',updateTower)"></select>
                    <select id="bornMonth" onchange="refreshSolarDays('bornYear','bornMonth','bornDay',updateTower)"></select>
                    <select id="bornDay" onchange="updateTower()"></select>
                </div>
                <div id="sxDisplay" class="hidden">
                    <div id="dirList" class="space-y-2"></div>
                    <div class="mt-4 px-3 py-2 bg-rose-50 text-xs text-rose-700 rounded-lg border border-rose-100">
                        ⚠️ <span id="yearLabel" class="font-bold">--</span>年煞方位：<span id="currentYearBad" class="font-black">--</span> (不宜做向)
                    </div>
                </div>
                <div id="towerPlaceholder" class="text-center text-stone-400 text-sm py-10 bg-stone-50 rounded-xl border border-dashed border-stone-300">請選擇上方日期</div>
            </div>
        </div>

        <div id="panel-data" class="tab-content space-y-4">
            <div class="card">
                <div class="section-header"><div class="section-title"><span>🏺</span> 60 仙命速查</div></div>
                <select id="xmSelector" onchange="updateXMData()" class="bg-amber-50 border-amber-200 text-amber-900 font-bold mb-4"></select>
                <div id="xmResult" class="space-y-3">
                    <div class="xm-result-box border-l-emerald-500">
                        <span class="xm-tag bg-emerald-100 text-emerald-800">宜坐山 (六吉)</span>
                        <div id="xmBigLucky" class="text-base font-bold text-emerald-700">--</div>
                    </div>
                    <div class="xm-result-box border-l-rose-500">
                        <span class="xm-tag bg-rose-100 text-rose-800">忌座向 (大忌)</span>
                        <div id="xmBigBad" class="text-base font-bold text-rose-700">--</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="panel-ai" class="tab-content">
            <div class="card bg-slate-800 text-white border-none">
                <h2 class="text-xl font-bold text-amber-400 mb-4">💡 禾欣 AI 禮儀顧問</h2>
                <textarea id="aiPrompt" rows="5" class="w-full bg-white/10 border-none text-white rounded-xl p-4 mb-4 text-sm" placeholder="請輸入您的問題..."></textarea>
                <button onclick="askAI()" id="aiBtn" class="w-full bg-amber-600 py-3 rounded-xl font-bold">送出諮詢</button>
                <div id="aiRes" class="mt-6 p-5 bg-black/20 rounded-xl text-sm hidden"></div>
            </div>
        </div>

        <footer class="mt-12 text-center text-slate-400 pb-8">
            <p class="text-[10px] tracking-[0.3em] uppercase">Hsin Her Funeral Service System</p>
            <p class="text-xs mt-2 font-bold text-slate-500">禾欣生命禮儀 · v2.2</p>
        </footer>
    </div>

    <script src="script.js"></script>
</body>
</html>