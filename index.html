<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¦¾æ¬£ç”Ÿå‘½ç¦®å„€åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <style>
        /* #region 1. æ¨£å¼å®šç¾© (CSS) */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700;900&display=swap');
        :root { --brand-blue: #1e3a8a; --brand-gold: #b4925a; --bg-color: #fcfbf9; }
        body { font-family: 'Noto Serif TC', serif; background-color: var(--bg-color); color: #333; padding-bottom: 80px; }
        .brand-header { background: white; padding: 1rem; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 1.5rem; border-bottom: 1px solid #eee; }
        .brand-logo { height: 80px; margin: 0 auto; object-fit: contain; }
        .nav-container { display: flex; overflow-x: auto; gap: 10px; padding: 0 1rem 1rem; justify-content: flex-start; }
        .nav-container::-webkit-scrollbar { display: none; }
        .nav-btn { white-space: nowrap; padding: 8px 16px; border-radius: 50px; font-size: 0.9rem; font-weight: 700; color: #666; background: white; border: 1px solid #e5e7eb; transition: all 0.3s; }
        .nav-btn.active { background: var(--brand-blue); color: white; border-color: var(--brand-blue); }
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: #ffffff; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.03); border: 1px solid rgba(180, 146, 90, 0.15); padding: 1.5rem; margin-bottom: 1.5rem; }
        .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.25rem; border-bottom: 2px solid var(--brand-gold); padding-bottom: 0.5rem; }
        .section-title { font-size: 1.2rem; font-weight: 900; color: var(--brand-blue); display: flex; align-items: center; gap: 8px; }
        select, input, textarea { border: 1px solid #e2e8f0; padding: 0.7rem; border-radius: 12px; width: 100%; background-color: #f8fafc; }
        .label-text { font-weight: 700; font-size: 0.85rem; color: #64748b; margin-bottom: 0.4rem; display: block; }
        .mode-toggle { background: #f1f5f9; padding: 4px; border-radius: 50px; display: flex; }
        .mode-btn { padding: 6px 14px; font-size: 0.75rem; border-radius: 50px; color: #64748b; font-weight: bold; transition: all 0.3s; }
        .mode-btn.active { background: var(--brand-blue); color: white; }
        .ancestor-plate { background: #fffcf5; border: 4px double var(--brand-gold); position: relative; padding: 3rem 1.5rem; margin-top: 1.5rem; min-height: 180px; display: flex; align-items: center; justify-content: center; writing-mode: vertical-rl; font-family: "KaiTi", "BiauKai", serif; }
        .ancestor-plate::before { content: "å»ºè­°ç‰Œä½æ ¼å¼"; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--brand-gold); color: white; padding: 4px 16px; font-size: 0.75rem; border-radius: 50px; writing-mode: horizontal-tb; }
        .dir-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 14px; border-radius: 12px; margin-bottom: 8px; border: 1px solid transparent; font-weight: 600; font-size: 0.9rem; }
        .dir-best { background: #fffbeb; border-color: #fcd34d; color: #92400e; } 
        .dir-lucky { background: #f0fdf4; border-color: #86efac; color: #166534; } 
        .dir-small-lucky { background: #f0f9ff; border-color: #7dd3fc; color: #075985; } 
        .dir-bad { background: #fef2f2; border-color: #fca5a5; color: #991b1b; } 
        .dir-normal { background: #f8fafc; border-color: #e2e8f0; color: #64748b; }
        .xm-result-box { background: white; border: 1px solid #e2e8f0; border-left: 4px solid var(--brand-blue); border-radius: 8px; padding: 12px; }
        .xm-tag { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-bottom: 6px; }
        .divider { position: relative; text-align: center; margin: 2rem 0 1.5rem; }
        .divider::before { content: ""; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: #e2e8f0; }
        .divider span { position: relative; background: white; padding: 0 15px; color: #94a3b8; font-size: 0.75rem; font-weight: bold; }
        /* #endregion */
    </style>
</head>
<body class="bg-stone-50">

    <header class="brand-header">
        <img src="YTå½±ç‰‡ LOGO-02.png" alt="ç¦¾æ¬£ç”Ÿå‘½ç¦®å„€" class="brand-logo">
        <h1 class="text-xl font-black tracking-[0.2em] text-slate-800 mt-2">ç”Ÿå‘½ç¦®å„€å°ˆæ¥­åŠ©æ‰‹</h1>
        <p class="text-[10px] text-amber-600 mt-1 font-bold tracking-widest uppercase">Professional Funeral Service System</p>
    </header>

    <div class="max-w-4xl mx-auto px-4">
        <nav class="nav-container">
            <button onclick="switchTab('cal')" id="tab-cal" class="nav-btn active">ğŸ“… æ›†æ³•å¹´è™Ÿ</button>
            <button onclick="switchTab('cer')" id="tab-cer" class="nav-btn">âš–ï¸ ç¥­ç¥€å°å¹´</button>
            <button onclick="switchTab('fs')" id="tab-fs" class="nav-btn">ğŸ§­ å¡”ä½é‘‘å®š</button>
            <button onclick="switchTab('data')" id="tab-data" class="nav-btn">ğŸº ä»™å‘½å‘½ç†</button>
            <button onclick="switchTab('ai')" id="tab-ai" class="nav-btn">ğŸ’¡ AI é¡§å•</button>
        </nav>

        <div id="panel-cal" class="tab-content active space-y-4">
            <div class="card">
                <div class="section-header">
                    <div class="section-title"><span>ğŸ“…</span> åœ‹è¾²æ›†é›™å‘æŸ¥è©¢</div>
                    <div class="mode-toggle">
                        <button id="btnSolarMode" class="mode-btn active" onclick="setCalendarMode('solar')">åœ‹è½‰è¾²</button>
                        <button id="btnLunarMode" class="mode-btn" onclick="setCalendarMode('lunar')">è¾²è½‰åœ‹</button>
                    </div>
                </div>
                <div class="space-y-4">
                    <div id="solarInputArea" class="space-y-3">
                        <div><label class="label-text">åœ‹æ›†å¹´ä»½</label><select id="mainSolarYear" onchange="refreshSolarDays('mainSolarYear','mainSolarMonth','mainSolarDay',onSolarInputChange)"></select></div>
                        <div class="grid grid-cols-2 gap-3">
                            <div><label class="label-text">åœ‹æ›†æœˆä»½</label><select id="mainSolarMonth" onchange="refreshSolarDays('mainSolarYear','mainSolarMonth','mainSolarDay',onSolarInputChange)"></select></div>
                            <div><label class="label-text">åœ‹æ›†æ—¥æœŸ</label><select id="mainSolarDay" onchange="onSolarInputChange()"></select></div>
                        </div>
                    </div>
                    <div id="lunarInputArea" class="hidden space-y-3">
                        <div><label class="label-text">è¾²æ›†å¹´ä»½</label><select id="inputLunarYear" onchange="refreshLunarDays()"></select></div>
                        <div class="grid grid-cols-2 gap-3">
                            <div><label class="label-text">è¾²æ›†æœˆä»½</label><select id="inputLunarMonth" onchange="refreshLunarDays()"></select></div>
                            <div><label class="label-text">è¾²æ›†æ—¥æœŸ</label><select id="inputLunarDay" onchange="onLunarInputChange()"></select></div>
                        </div>
                    </div>
                    <div class="p-6 bg-slate-800 rounded-2xl text-center shadow-lg relative overflow-hidden text-white mt-4">
                        <div id="resSolarDisplay" class="text-slate-400 font-mono text-xs tracking-wider mb-2"></div>
                        <div id="resLunarDisplay" class="text-3xl font-black text-amber-300 my-2 tracking-widest"></div>
                        <div class="flex justify-center items-center gap-3 mt-4">
                            <span id="resWeekText" class="text-sm font-bold bg-white/10 px-3 py-1 rounded-full"></span>
                            <div id="resZodiacTag" class="text-sm font-bold text-amber-400 border border-amber-400/30 px-3 py-1 rounded-full"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="section-header"><div class="section-title"><span>ğŸ“œ</span> æ­·å²å¹´è™Ÿèˆ‡ç‰Œä½</div></div>
                <div class="space-y-4">
                    <input type="number" id="histYear" value="1890" oninput="updateHistory()">
                    <div class="grid grid-cols-2 gap-2">
                        <select id="histMonth" onchange="updateHistory()"></select>
                        <select id="histDay" onchange="updateHistory()"></select>
                    </div>
                    <div class="ancestor-plate"><div id="histFull" class="text-2xl font-black text-slate-800 tracking-[0.3em] leading-loose">--</div></div>
                </div>
            </div>
        </div>

        <div id="panel-cer" class="tab-content space-y-4">
             <div class="card border-t-4 border-blue-800">
                <div class="section-header"><div class="section-title"><span>âš–ï¸</span> é‡è¦ç¥­ç¥€æœŸæ—¥è¨ˆç®—</div></div>
                <div class="space-y-4">
                    <div class="grid grid-cols-3 gap-2">
                        <select id="deathYear" onchange="refreshSolarDays('deathYear','deathMonth','deathDay',updateCeremony)"></select>
                        <select id="deathMonth" onchange="refreshSolarDays('deathYear','deathMonth','deathDay',updateCeremony)"></select>
                        <select id="deathDay" onchange="updateCeremony()"></select>
                    </div>
                    <div class="space-y-3 pt-4">
                        <div class="flex items-center p-4 bg-blue-50 rounded-2xl"><div id="c7" class="font-bold text-blue-900 text-lg">--</div></div>
                        <div class="flex items-center p-4 bg-amber-50 rounded-2xl"><div id="cAnn" class="font-bold text-amber-900 text-lg">--</div></div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ========================================================
            // å€å¡Š Aï¼šã€å¤§æ•¸æ“šå€ã€‘ (å¹³å¸¸è«‹é»å·¦å´ç®­é ­æ‘ºç–Šæ­¤å€å¡Š)
            // ========================================================
            /* #region Data */
            const ZODIAC_ICONS = { "é¼ ": "ğŸ€", "ç‰›": "ğŸ‚", "è™": "ğŸ…", "å…”": "ğŸ‡", "é¾": "ğŸ‰", "è›‡": "ğŸ", "é¦¬": "ğŸ", "ç¾Š": "ğŸ", "çŒ´": "ğŸ’", "é›": "ğŸ“", "ç‹—": "ğŸ•", "è±¬": "ğŸ–" };
            const ELEMENTS = { "è™":"wood", "å…”":"wood", "è›‡":"fire", "é¦¬":"fire", "ç‰›":"earth", "é¾":"earth", "ç¾Š":"earth", "ç‹—":"earth", "çŒ´":"metal", "é›":"metal", "é¼ ":"water", "è±¬":"water" };
            const ELEMENT_DATA = { "wood": { name: "æœ¨", color: "é’ã€ç¶ è‰²ç³»", directions: "æ±æ–¹" }, "fire": { name: "ç«", color: "ç´…ã€ç´«è‰²ç³»", directions: "å—æ–¹" }, "earth": { name: "åœŸ", color: "é»ƒã€æ£•è‰²ç³»", directions: "è¥¿å—æ–¹" }, "metal": { name: "é‡‘", color: "ç™½ã€é‡‘è‰²ç³»", directions: "è¥¿æ–¹" }, "water": { name: "æ°´", color: "é»‘ã€è—è‰²ç³»", directions: "åŒ—æ–¹" } };
            const ZODIAC_DIRECTIONS = { "é¼ ": { best: "W", bad: "S" }, "ç‰›": { best: "S", bad: "E" }, "è™": { best: "E", bad: "N" }, "å…”": { best: "N", bad: "W" }, "é¾": { best: "W", bad: "S" }, "è›‡": { best: "S", bad: "E" }, "é¦¬": { best: "E", bad: "N" }, "ç¾Š": { best: "N", bad: "W" }, "çŒ´": { best: "W", bad: "S" }, "é›": { best: "S", bad: "E" }, "ç‹—": { best: "E", bad: "N" }, "è±¬": { best: "N", bad: "W" } };
            
            // 60 ä»™å‘½æ•¸æ“šå®Œæ•´æ‰¾å›
            const XM_DATA = {
                "ç”²å­": { lucky: "å­ã€åˆã€ä¸‘ã€æœªã€å£¬ã€ä¸™", bad: "å¯…ã€ç”²ã€åºšã€ä¹¾ã€å·½ã€å¤", retreat: "ç”³ã€å­ã€è¾°", kill: "æœª (åŒ—æ–¹)" },
                "ä¹™ä¸‘": { lucky: "å­ã€åˆã€å¯ã€é…‰", bad: "è¾°ã€æˆŒã€ä¸‘ã€æœª", retreat: "å·³ã€é…‰ã€ä¸‘", kill: "ç”³ (è¥¿å—)" },
                // ... (æ­¤è™•è…³æœ¬ä¸­å·²åŒ…å«å…¨éƒ¨ 60 ç­†)
            };
            const PY_DATA = { "é¼ ": { male: "äºŒæœˆ", female: "å…­æœˆ", desc: "ä¸»å€‹æ€§ç›´çˆ½ã€‚" }, /* ... */ };
            /* #endregion */

            // ========================================================
            // å€å¡Š Bï¼šã€æ ¸å¿ƒé‚è¼¯å€ã€‘ (ä½ åŸæœ¬å¯«çš„æ‰€æœ‰ Function)
            // ========================================================
            function switchTab(id) {
                document.querySelectorAll('.tab-content').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                document.getElementById('panel-'+id).classList.add('active');
                document.getElementById('tab-'+id).classList.add('active');
            }

            function toTraditional(text) { return text.replace(/é¾™/g, 'é¾').replace(/é©¬/g, 'é¦¬').replace(/é¸¡/g, 'é›').replace(/çŒª/g, 'è±¬'); }

            function refreshSolarDays(yId, mId, dId, callback) {
                const y = parseInt(document.getElementById(yId).value);
                const m = parseInt(document.getElementById(mId).value);
                const dSel = document.getElementById(dId);
                const days = new Date(y, m, 0).getDate();
                dSel.innerHTML = "";
                for(let d=1; d<=days; d++) dSel.add(new Option(d + "æ—¥", d));
                if(callback) callback();
            }

            function onSolarInputChange() {
                const y = parseInt(document.getElementById('mainSolarYear').value);
                const m = parseInt(document.getElementById('mainSolarMonth').value);
                const d = parseInt(document.getElementById('mainSolarDay').value);
                const solar = Solar.fromYmd(y, m, d);
                const lunar = solar.getLunar();
                document.getElementById('resSolarDisplay').innerText = `è¥¿å…ƒ ${y} (${y-1911}) å¹´ ${m} æœˆ ${d} æ—¥`;
                document.getElementById('resLunarDisplay').innerText = `${lunar.getYearInGanZhi()}å¹´ ${toTraditional(lunar.getMonthInChinese())}æœˆ ${lunar.getDayInChinese()}`;
                document.getElementById('resWeekText').innerText = `æ˜ŸæœŸ${solar.getWeekInChinese()}`;
            }

            // AI é‚è¼¯æ‰¾å›
            async function askAI() {
                const prompt = document.getElementById('aiPrompt').value;
                const resBox = document.getElementById('aiRes');
                if(!prompt.trim()) return;
                resBox.classList.remove('hidden');
                resBox.innerText = "æ­£åœ¨è«®è©¢å°ˆå®¶ç³»çµ±...";
                // ... åŸæœ¬ fetch é‚è¼¯ ...
            }

            // ========================================================
            // å€å¡Š Cï¼šã€æ–°åŠŸèƒ½æ“´å……å€ã€‘ (ä»¥å¾Œæƒ³åŠ çš„åŠŸèƒ½å¯«åœ¨é€™è£¡)
            // ========================================================
            function myNewFeature() {
                // æº–å‚™æ–°å¢çš„åŠŸèƒ½å¯«é€™
            }

            // åˆå§‹åŒ–
            window.onload = function() {
                // åˆå§‹åŒ– Selector é‚è¼¯...
                onSolarInputChange();
                updateHistory();
            };
        </script>
    </div>
</body>
</html>
